## step10 각 시나리오 기본, 심화 요구사항 구현 

### 콘서트 예약 서비스 

 **주요 API 구성**

- 유저 토큰 발급 API
- 예약 가능 날짜 / 좌석 API
- 좌석 예약 요청 API
- 잔액 충전 / 조회 API
- 결제 API

기능 구현 완료 

1) 유저 토큰 발급 API 
userId를 활용하여 sha256으로 해싱한 string을 PK로 가지는 토큰을 발급하는 기능을 구현하였습니다.

JWT를 활용할 수도 있었겠지만 제가 발급한 토큰임을 확인하는데 해싱한 문자열로 충분히 가능할 것으로 생각하였습니다.

2) 예약 가능 날짜 / 좌석 API
콘서트 schedule 엔티티와 콘서트 seat 엔티티를 양방향 연관관계를 잡고 콘서트 스케쥴이 사라진다면 예약 가능한 좌석이 사라진다는
생각으로 작성하였습니다.

질문사항: 미리 seatNo를 발급 해놓고 조회하면서 update 치는 식으로 자리배정을 해야 할지 , 아니면 크기를 제한해놓고 
seat no를 50이하의 수만 요청 가능하도록 제한할지가 고민이 되었습니다.

3) 콘서트 예약 API
 예약정보를 구성하기위한 concert, user, payment usecase를 작성하여 facade 계층을 만들었습니다.

4) 잔액 충전 / 조회 API
해당 user의 요청시 잔액이 충전되고 , 조회가 가능한 API를 작성하였습니다.

5) 결제 API
외부 시스템의 API를 사용하는것으로 가정하고 요청시 httpStatus 200을 반환하면 결제가 정상진행된 것으로 간주하여 작성하였습니다.

통합 테스트 회고 


- 콘서트 예약 API 

동시성 이슈를 고려하여 비관적 락을 사용하고 락 끼리 교착상태에 빠지는 데드락을 방어하기위해 순차적으로 flow가 진행되길 기대했지만 
성공확률이 50 % 에서 더 올라오지 않았습니다. -> 리팩토링 예정

-  잔액 충전 API 
동시에 같은 요청이 여러번 들어와도 한 번만 수행되길 바래서 lock을 활용하여 lock을 획득한 요청만 수행되고 나머지는 무시되는 flow를 생각하였습니다.

test 시 timeout 시간을 1로 두고 계속 test를 진행하였는데 여러번 성공하게 되는 이슈가 있었는데 요청이 1초보다 빠르게 완료되어 다음 요청이 대기할 시간을 벌어
준 것으로 판단하여 timeout 시간을 0으로 두고 test하여 해당 test가 성공함을 확인하였습니다.


